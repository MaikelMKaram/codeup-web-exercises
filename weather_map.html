<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title></title>
<!--    Bootstrap-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!--    Mapbox-->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.css' rel='stylesheet'/>
</head>
<body>
<main>

<!--   NavBar -->
    <div class="container">
        <nav class="navbar navbar-expand-lg navbar-light bg-primary">
            <a class="navbar-brand ms-2 fw-bold text-light" href="#">Weather App</a>


        </nav>
    </div>

<!--    Row-->
    <div  class="container">
        <div class="row">
        </div>
    </div>
<!--    Map -->
    <div class="container">
    <div id='map' style='width: 100%; height: 500px; margin-top: 5px'></div>
    </div>
</main>

<!-- JQuery-->
<script src="https://code.jquery.com/jquery-2.2.4.min.js"
        integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<!-- custom JS -->
<script src="js/api-key.js"></script>
<!-- Geocoder JS -->
<script src="js/mapbox-geocoder-utils.js"></script>
</script>
<script>
    mapboxgl.accessToken = key;

    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [-86.80541779251777, 33.404339086319375],
        zoom: 12,
        projection: 'globe'
    });

    map.on('style.load', () => {
        map.setFog({});
    });

    let count = 5;
    let date;
    let tempMax;
    let tempMin;
    let icon;
    let description;
    let humidity;
    let wind;
    let pressure;

        $.ajax({
            url: "http://api.openweathermap.org/data/2.5/forecast",
            type: "GET",
            data: {
                APPID: weatherKey,
                q: 'Birmingham, US',
                units: "imperial",
            }
        }).done(function (data) {
            //console logs
            console.log(data);

            data.list.forEach(function (x) {
                if (x.dt_txt.split(" ")[1] === '00:00:00' && count !== 0) {

                    date = x.dt_txt.split(" ")[0];
                    tempMax = x.main.temp_max;
                    tempMin = x.main.temp_min;
                    icon = x.weather[0].icon;
                    description = x.weather[0].description;
                    humidity = x.main.humidity;
                    wind = x.wind.speed;
                    pressure = x.main.pressure;

                    let html = "";
                    html += '<div class="col card-header"><p class="mb-4 card-header">' + date + "</p>";
                    html += '<p class="mb-2">' + tempMin + '˚F' + ' | ' + tempMax + '˚F' + '</p>';
                    html += '<img src="http://openweathermap.org/img/w/' + icon + '.png">'
                    html += '<p class="mb-2">' + 'Desciption: ' + "<strong>" + description + "</strong>" + '</p>';
                    html += '<p class="mb-2">' + 'Humdidity: ' + humidity + '</p>';
                    html += '<p class="mb-2"> ' + 'Wind: ' + wind + '</p>';
                    html += '<p>' + 'Pressure: ' + pressure + '</p>'
                    html += '</div>';

                    $('.row').append(html);
                    count--;
                }
            })
        })

    console.log(this);


     // Click Marker
    this.marker = new mapboxgl.Marker();
    this.map.on('click', this.mainFunction.bind(this),
    );

    function mainFunction(para){
            console.log(para)
            var input = para.lngLat
        this.marker.setLngLat(input).addTo(this.map);
        $.ajax({
            url: "http://api.openweathermap.org/data/2.5/forecast",
            type: "GET",
            data: {
                APPID: weatherKey,
                lat: input.lat,
                lng: input.lng,
                units: "imperial",
            }
        }).done(function (data) {
            //console logs
            console.log(data);

            data.list.forEach(function (x) {
                if (x.dt_txt.split(" ")[1] === '00:00:00' && count !== 0) {

                    date = x.dt_txt.split(" ")[0];
                    tempMax = x.main.temp_max;
                    tempMin = x.main.temp_min;
                    icon = x.weather[0].icon;
                    description = x.weather[0].description;
                    humidity = x.main.humidity;
                    wind = x.wind.speed;
                    pressure = x.main.pressure;

                    let html = "";
                    html += '<div class="col card-header"><p class="mb-4 card-header">' + date + "</p>";
                    html += '<p class="mb-2">' + tempMin + '˚F' + ' | ' + tempMax + '˚F' + '</p>';
                    html += '<img src="http://openweathermap.org/img/w/' + icon + '.png">'
                    html += '<p class="mb-2">' + 'Desciption: ' + "<strong>" + description + "</strong>" + '</p>';
                    html += '<p class="mb-2">' + 'Humdidity: ' + humidity + '</p>';
                    html += '<p class="mb-2"> ' + 'Wind: ' + wind + '</p>';
                    html += '<p>' + 'Pressure: ' + pressure + '</p>'
                    html += '</div>';

                    $('.row').append(html);
                    count--;
                }
            })
        })
    }
</script>
</body>
</html>